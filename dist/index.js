import*as e from"react";const{useEffect:n,useState:t}=e,i=/Windows.*Chrome|Windows.*Firefox|Linux.*Chrome/,o={enabled:!0,url:"https://ipv4.icanhazip.com/",timeout:5e3,interval:5e3};class r{pollingConfigs;static instance;intervalId;constructor(e=o){this.pollingConfigs=e}setIntervalId(e){this.intervalId=e}getIntervalId(){return this.intervalId}static getInstance(e){return r.instance||(r.instance=new r),r.instance.setPollingConfigs(e),r.instance}setPollingConfigs(e){i.test(navigator?.userAgent)?"object"==typeof e?this.pollingConfigs={...o,...e}:e&&(this.pollingConfigs=o):this.pollingConfigs={...o,enabled:!1}}ping({url:e,timeout:n}){return new Promise(((t,i)=>{const o=new XMLHttpRequest;o.onerror=i,o.ontimeout=i,o.onreadystatechange=()=>{o.readyState===o.HEADERS_RECEIVED&&(o.status?t():i())},o.open("HEAD",e),o.timeout=n,o.send()}))}}const s=(e=!0)=>{const[i,o]=t(!0),s=r.getInstance(e),a=()=>{o(!0)},c=()=>{o(!1)};return n((()=>{window.addEventListener("online",a),window.addEventListener("offline",c);let e=s.getIntervalId();const{enabled:n,url:t,timeout:i,interval:r}=s.pollingConfigs;return n&&t&&(e&&clearInterval(e),e=window.setInterval((async()=>{try{await s.ping({url:t,timeout:i}),o(!0)}catch(e){o(!1)}}),r),s.setIntervalId(e)),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",c),n&&clearInterval(e)}}),[]),{isOnline:i}};let a=!1;const c=e=>{a=navigator&&"connection"in navigator&&"effectiveType"in navigator.connection;const i={supported:a,effectiveConnectionType:a?navigator.connection.effectiveType:e},[o,r]=t(i);return n((()=>{if(a){const e=navigator.connection,n=()=>{r({supported:a,effectiveConnectionType:e.effectiveType})};return e.addEventListener("change",n),()=>{e.removeEventListener("change",n)}}}),[]),{...o,setNetworkStatus:e=>{r({supported:a,...e})}}};export{c as useNetworkStatus,s as useOnlineEffect};
